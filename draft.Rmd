
## R Markdown

```{r, echo=FALSE, message=FALSE, warning=FALSE}
library(tidyverse)
library(readxl)
library(ggplot2)
library(haven)
```


```{r}
#DATA RECONSTRUCTION

#data chapter
#erklaeren mit einzelnen dataframes, graphs -> daily load aggregate uebersicht uebere time usw.

#uebersicht / einfuehrung mit data world


dat = read.csv("./dir/Part 3 Schedule 2 - Planning Area Hourly Demand.csv", header = TRUE) #atm nicht in wd, zu gross fuer github -> in backup wd
head(dat, 1000)

```






```{r, echo=FALSE, message=FALSE, warning=FALSE}
# Graph Paper FIGURE 1 (Seite 2)
# Daten nicht in Anlagen: World Bank Commodity Price Data (Pink Sheet) https://www.worldbank.org/en/research/commodity-markets#1
# In Graph Daten nur bis 2013 genommen ?! -> evtl ganze Zeitreihe


CMOHistoricalDataMonthly <- read_excel("dir/CMOHistoricalDataMonthly.xlsx", sheet = "Monthly Prices")

results <- as.data.frame(CMOHistoricalDataMonthly)

results$date <- as.Date(results$date)

ggplot(data=results, aes(x=date)) +
  geom_line(aes(y=results$`Natural gas, US ($/mmbtu)`, color="US"), size=1) +
  geom_line(aes(y=results$`Natural gas, Europe ($/mmbtu)`, color="Europe"), size=1) +
  labs(x = "Year", y = "", title = "US and European Natural Gas Prices", subtitle = "Y=$/MMBTU")+
  scale_color_manual(name="Region",values = c("blue","red"))
  
```



```{r, echo=FALSE, message=FALSE, warning=FALSE}
#Graph Paper FIGURE 2 (Page 6)
#Daten graph_gas_coal_gen.dta

graph_gas_coal_gen <- read_dta("dir/graph_gas_coal_gen.dta")

results2 <- as.data.frame(graph_gas_coal_gen)
results2$date <- as.Date(results2$date)



ggplot(data=results2, aes(x=date)) +
  geom_line(aes(y=results2$coal, color="Coal Generation (TWh)"), size=1) +
  geom_line(aes(y=results2$gas, color="Natural Gas Generation (TWh)"), size=1, linetype="dotted") +
  labs(x = "Year", y = "", title = "Monthly Generation by Fueltype", subtitle = "Y=Monthly Electricty (TWh)")+
  scale_color_manual(name="",values = c("black","red"))+
  scale_y_continuous(breaks=seq(0,200,25))
  #scale_x_date(breaks = [2001,2014])




```



```{r, echo=FALSE, message=FALSE, warning=FALSE}

#TABLE 1 Summary Statistics
finaldata_allgens <- read_dta("dir/finaldata_allgens.dta")

table1 <- finaldata_allgens %>% 
  group_by(intercn) %>% 
  select(CO2MASS, load, gasprice2, coal_price) %>% 
  mutate(CO2MASS = CO2MASS/1000, load=load/1000, Emission_Rate=CO2MASS/load, Cost_Ratio=coal_price/gasprice2) %>% 
  summarise_all("mean") 
  
#table1 <- table1 %>% 
 # rownames_to_column %>% 
  #gather(var, value, -rowname) %>% 
  #spread(rowname,value)


table1
```


![some caption](diri/interconnections.png)

```{r}
#FIGURE 4

#A
#hor line bei 2.25 und 5.75
#


# CREATE DATAFRAME HERE

ggplot() +
  geom_abline(yintercept=1:5, slope=1) +
  geom_abline(yintercept=5.75, slope=0.1) +
  geom_hline(yintercept = c(2.25, 5.75)) +
  xlim(0,40) + ylim(0,14) 


ggplot(data.frame(x=c(0,120), y=c(0,14)), aes(x)) +
  stat_function(fun=function(x)5.75, geom="line", aes(colour="green")) +
  stat_function(fun=function(x)2.25, geom="line", aes(colour="black")) +
  stat_function(fun=function(x)0.39*x+5.75, geom="line", aes(colour="green")) +
  stat_function(fun=function(x)0.146*x+2.25, geom="line", aes(colour="black")) +
  labs(x = "Carbon Price $/ton", y = "$/mmBTU", title = "Carbon Prices") +
  geom_vline(xintercept = c(40))
  


```

```{r}
#FIGURE 5


library(plotly)

x= list("Renewables Nuclear", "Gas CC", "Coal", "Gas GT")
measure= c("relative", "relative", "relative", "relative")
text= c("+60", "+80", "-40", "-20")
y= c(0, 18, 2, 8)
data = data.frame(x=factor(x,levels=x),measure,text,y)

p <- plot_ly(
  data, name = "20", type = "waterfall", measure = ~measure,
  x = ~x, textposition = "outside", y= ~y, text =~text,
  connector = list(line = list(color= "rgb(63, 63, 63)"))) %>%
  layout(title = "Profit and loss statement 2018",
        xaxis = list(title = ""),
        yaxis = list(title = ""),
        autosize = TRUE,
        showlegend = TRUE)

p




```

```{r}
#FIGURE 6

head(finaldata_allgens)

finaldata_allgens_temp <- finaldata_allgens %>% 
  mutate(PCO2 = (gasprice2/coal_price * gasprice2 - coal_price)/(0.0585-gasprice2/coal_price*0.1054)) %>% 
  filter(intercn == "EAST")

head(finaldata_allgens_temp)


temp <- finaldata_allgens_temp$PCO2
head(temp)
```




#APENDIX

```{r}
#Table A2






```



```{r}
library(usmap)
library(ggplot2)

plot_usmap(regions = "states") +
  labs(title = "Western US States",
       subtitle = "These are the states in the Pacific Timezone.")







all_states <- map_data("state") 
states_positive  <-c("new york", "florida")
states_negative  <- c("texas")

ggplot(all_states, aes(x=long, y=lat, group = group)) +
  geom_polygon(fill="grey", colour = "white") +
  geom_polygon(fill="green", data = filter(all_states, region %in% states_positive)) +
  geom_polygon(fill="red", data = filter(all_states, region %in% states_negative))



```




Zusammenfassende Statistik der Daten



HTML Format finaldata allgens, formatieren, spalten gut benennen etc




```{r}
# graph fuer power plants Co2 emissions gegen rest umbennen graph, dann unten folgend aufgeteilt nach quellen



setwd("X:/libraries/RTutor_BA")

temp <- read.csv("./Data/Emissions_Unit_Type.csv")

list <- c("Power Plants")
list


# "Power Plants, Refineries", "Power Plants, Suppliers of CO2", "Power Plants, Waste"
temp3 <- tail(names(sort(table(temp$Industry.Type..sectors.))), 5)
temp3

temp <- temp %>%
  mutate(Industry.Type..sectors. = ifelse(!list,"Andere",Industry.Type..sectors.))

unique(temp$Industry.Type..sectors.)



temp <- temp %>% 
  filter(Industry.Type..sectors.==c("Power Plants", "Power Plants, Refineries", "Power Plants, Suppliers of CO2", "Power Plants, Waste"))

head(temp)

unique(temp$General.Fuel.Type)
unique(temp$Industry.Type..sectors.)
temp$General.Fuel.Type

temp1 <- temp %>% 
  group_by(Reporting.Year,Industry.Type..sectors.) %>% 
  summarise(emission=mean(Fuel.CO2.emissions..non.biogenic....metric.tons.)) %>% 
  ungroup()

temp2 <- temp %>% 
  group_by(Reporting.Year,General.Fuel.Type) %>% 
  summarise(emission=mean(Fuel.CO2.emissions..non.biogenic....metric.tons.)) %>% 
  ungroup()


#stacked bar plot


ggplot(temp1, aes(fill=Indus, y=emission, x=Reporting.Year)) + 
    geom_bar(position="fill", stat="identity")

temp

#gegenueberstellung emissions zu prod. strom
#danach ueberleitung zu motivation wieso thema!!

ggplot(temp2, aes(fill=General.Fuel.Type, y=emission, x=Reporting.Year)) + 
    geom_bar(position="fill", stat="identity")
```






